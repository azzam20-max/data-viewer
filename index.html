<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>International Faculty Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(15px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="rgba(255,255,255,0.1)"><path d="M0,0 C150,100 350,0 500,50 C650,100 850,0 1000,50 L1000,0 Z"/></svg>');
            background-size: cover;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .legend-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-bottom: 3px solid #dee2e6;
        }

        .legend-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px 18px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .legend-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .legend-text {
            font-weight: 600;
            color: #495057;
        }

        .legend-description {
            font-size: 0.9em;
            color: #6c757d;
            margin-left: 5px;
        }

        .controls {
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #f0f0f0;
        }

        .btn-group {
            display: inline-flex;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: white;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            background: white;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 15px;
            position: relative;
        }

        .btn:hover:not(.active) {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .content {
            padding: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 600;
            font-size: 1.1em;
        }

        .chart-container {
            position: relative;
            height: 550px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .analysis-section {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .analysis-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .analysis-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #667eea;
        }

        .insight-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }

        .insight-text {
            color: #6c757d;
            line-height: 1.6;
        }

        .data-table {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: linear-gradient(135deg, #495057, #6c757d);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
            font-size: 1em;
        }

        .data-table td {
            padding: 15px 18px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.08);
        }

        .program-name {
            font-weight: 600;
            color: #495057;
        }

        .category-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .gb { background: linear-gradient(135deg, #8884d8, #9b59b6); }
        .lk { background: linear-gradient(135deg, #82ca9d, #27ae60); }
        .l { background: linear-gradient(135deg, #ffc658, #f39c12); }
        .aa { background: linear-gradient(135deg, #ff7300, #e67e22); }
        .njfa { background: linear-gradient(135deg, #00ff88, #00d4aa); }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 20px;
            }
            
            .header {
                padding: 25px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .controls {
                padding: 20px;
            }
            
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .chart-container {
                height: 400px;
                padding: 20px;
            }

            .content {
                padding: 20px;
            }
        }

        .floating-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌍 International Faculty Dashboard</h1>
            <p>Comprehensive analysis of international faculty distribution by academic rank across study programs</p>
        </div>

        <div class="legend-container">
            <div class="legend-title">📋 Academic Rank Categories</div>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #8884d8, #9b59b6);"></div>
                    <div>
                        <span class="legend-text">GB</span>
                        <span class="legend-description">- Guru Besar (Professor)</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #82ca9d, #27ae60);"></div>
                    <div>
                        <span class="legend-text">LK</span>
                        <span class="legend-description">- Lektor Kepala (Associate Professor)</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #ffc658, #f39c12);"></div>
                    <div>
                        <span class="legend-text">L</span>
                        <span class="legend-description">- Lektor (Assistant Professor)</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #ff7300, #e67e22);"></div>
                    <div>
                        <span class="legend-text">AA</span>
                        <span class="legend-description">- Asisten Ahli (Lecturer)</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #00ff88, #00d4aa);"></div>
                    <div>
                        <span class="legend-text">NJFA</span>
                        <span class="legend-description">- Non Jabatan Fungsional (Non-Functional Position)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="btn active" onclick="showView('bar', this)">📊 Bar Chart</button>
                <button class="btn" onclick="showView('pie', this)">🥧 Rank Distribution</button>
                <button class="btn" onclick="showView('line', this)">📈 Program Comparison</button>
                <button class="btn" onclick="showView('analysis', this)">📋 Analysis</button>
                <button class="btn" onclick="showView('table', this)">📋 Data Table</button>
            </div>
        </div>

        <div class="content">
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">👥</span>
                    <div class="stat-number" id="totalFaculty">269</div>
                    <div class="stat-label">Total International Faculty</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">🎓</span>
                    <div class="stat-number" id="totalPrograms">10</div>
                    <div class="stat-label">Study Programs</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">📊</span>
                    <div class="stat-number" id="avgPerProgram">27</div>
                    <div class="stat-label">Average per Program</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">🏆</span>
                    <div class="stat-number" id="topCategory">L (112)</div>
                    <div class="stat-label">Most Common Rank</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">⭐</span>
                    <div class="stat-number" id="professors">2</div>
                    <div class="stat-label">Professors (GB)</div>
                </div>
            </div>

            <div id="chartView" class="chart-container">
                <canvas id="myChart"></canvas>
            </div>

            <div id="analysisView" style="display: none;">
                <div class="analysis-section">
                    <div class="analysis-title">
                        🔍 Key Insights & Analysis
                    </div>
                    <div class="analysis-content">
                        <div class="insight-card">
                            <div class="insight-title">Faculty Distribution</div>
                            <div class="insight-text">
                                Most international faculty hold the rank of Lektor (L) with 112 positions (41.6%), 
                                followed by NJFA positions with 70 faculty members (26.0%). This indicates a healthy 
                                mix of academic and non-functional positions.
                            </div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title">Senior Faculty Presence</div>
                            <div class="insight-text">
                                Only 2 Professors (GB) and 36 Associate Professors (LK) represent the senior academic 
                                ranks, suggesting opportunities for faculty development and promotion pathways.
                            </div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title">Program Leadership</div>
                            <div class="insight-text">
                                S1 Administrasi Bisnis leads with 35 international faculty, while S1 Teknik Elektro 
                                has the fewest with 17. This may reflect program size or international partnership focus.
                            </div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title">Academic Balance</div>
                            <div class="insight-text">
                                The combination of L (112) and AA (49) positions totals 161 faculty, representing 59.9% 
                                of all international faculty in teaching-focused academic ranks.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">
                        📈 Program Rankings by International Faculty
                    </div>
                    <div class="analysis-content">
                        <div class="insight-card">
                            <div class="insight-title">Top 5 Programs</div>
                            <div class="insight-text">
                                1. S1 Administrasi Bisnis (35)<br>
                                2. S1 ICT Business (32)<br>
                                3. S1 Akuntansi (30)<br>
                                4. S1 Informatika (30)<br>
                                5. S1 Ilmu Komunikasi (28)
                            </div>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title">Growth Opportunities</div>
                            <div class="insight-text">
                                Programs with fewer international faculty like S1 Teknik Elektro (17), 
                                S1 Desain Komunikasi Visual (21), and S1 Teknik Industri (22) could benefit 
                                from targeted international recruitment.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tableView" class="data-table" style="display: none;">
                <div class="table-header">
                    📊 Detailed International Faculty Distribution
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Study Program</th>
                            <th>GB (Professor)</th>
                            <th>LK (Assoc. Prof.)</th>
                            <th>L (Asst. Prof.)</th>
                            <th>AA (Lecturer)</th>
                            <th>NJFA (Non-Func.)</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="floating-info">
        💡 Hover over charts for details
    </div>

    <script>
        const facultyData = [
            { program: "S1 ADMINISTRASI BISNIS", GB: 0, LK: 4, L: 14, AA: 3, NJFA: 14, total: 35 },
            { program: "S1 AKUNTANSI", GB: 0, LK: 2, L: 18, AA: 6, NJFA: 4, total: 30 },
            { program: "S1 DESAIN KOMUNIKASI VISUAL", GB: 0, LK: 0, L: 8, AA: 7, NJFA: 6, total: 21 },
            { program: "S1 ICT BUSINESS", GB: 1, LK: 11, L: 15, AA: 3, NJFA: 2, total: 32 },
            { program: "S1 ILMU KOMUNIKASI", GB: 0, LK: 3, L: 11, AA: 5, NJFA: 9, total: 28 },
            { program: "S1 INFORMATIKA", GB: 1, LK: 4, L: 9, AA: 7, NJFA: 9, total: 30 },
            { program: "S1 SISTEM INFORMASI", GB: 0, LK: 2, L: 5, AA: 9, NJFA: 8, total: 24 },
            { program: "S1 TEKNIK ELEKTRO", GB: 0, LK: 3, L: 7, AA: 3, NJFA: 4, total: 17 },
            { program: "S1 TEKNIK INDUSTRI", GB: 0, LK: 3, L: 11, AA: 3, NJFA: 5, total: 22 },
            { program: "S1 TEKNIK TELEKOMUNIKASI", GB: 0, LK: 4, L: 14, AA: 3, NJFA: 7, total: 28 }
        ];

        let currentChart = null;

        function showView(viewType, buttonElement) {
            // Update button states
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            } else {
                // Fallback: find button by viewType
                const buttons = document.querySelectorAll('.btn');
                const viewTypes = ['bar', 'pie', 'line', 'analysis', 'table'];
                const index = viewTypes.indexOf(viewType);
                if (index !== -1 && buttons[index]) {
                    buttons[index].classList.add('active');
                }
            }

            // Show/hide views
            document.getElementById('chartView').style.display = 'none';
            document.getElementById('tableView').style.display = 'none';
            document.getElementById('analysisView').style.display = 'none';

            if (viewType === 'table') {
                document.getElementById('tableView').style.display = 'block';
                populateTable();
            } else if (viewType === 'analysis') {
                document.getElementById('analysisView').style.display = 'block';
            } else {
                document.getElementById('chartView').style.display = 'block';
                createChart(viewType);
            }
        }

        // Make showView globally available
        window.showView = showView;

        function createChart(type) {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }

            const programs = facultyData.map(d => d.program.replace('S1 ', ''));
            const colors = {
                GB: '#8884d8',
                LK: '#82ca9d', 
                L: '#ffc658',
                AA: '#ff7300',
                NJFA: '#00ff88'
            };

            let config;

            if (type === 'bar') {
                config = {
                    type: 'bar',
                    data: {
                        labels: programs,
                        datasets: [
                            {
                                label: 'GB (Professor)',
                                data: facultyData.map(d => d.GB),
                                backgroundColor: colors.GB,
                                borderColor: colors.GB,
                                borderWidth: 1
                            },
                            {
                                label: 'LK (Associate Professor)',
                                data: facultyData.map(d => d.LK),
                                backgroundColor: colors.LK,
                                borderColor: colors.LK,
                                borderWidth: 1
                            },
                            {
                                label: 'L (Assistant Professor)',
                                data: facultyData.map(d => d.L),
                                backgroundColor: colors.L,
                                borderColor: colors.L,
                                borderWidth: 1
                            },
                            {
                                label: 'AA (Lecturer)',
                                data: facultyData.map(d => d.AA),
                                backgroundColor: colors.AA,
                                borderColor: colors.AA,
                                borderWidth: 1
                            },
                            {
                                label: 'NJFA (Non-Functional)',
                                data: facultyData.map(d => d.NJFA),
                                backgroundColor: colors.NJFA,
                                borderColor: colors.NJFA,
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'International Faculty Distribution by Program and Academic Rank',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Faculty'
                                }
                            }
                        }
                    }
                };
            } else if (type === 'pie') {
                const categoryTotals = {
                    'GB (Professor)': facultyData.reduce((sum, d) => sum + d.GB, 0),
                    'LK (Associate Professor)': facultyData.reduce((sum, d) => sum + d.LK, 0),
                    'L (Assistant Professor)': facultyData.reduce((sum, d) => sum + d.L, 0),
                    'AA (Lecturer)': facultyData.reduce((sum, d) => sum + d.AA, 0),
                    'NJFA (Non-Functional)': facultyData.reduce((sum, d) => sum + d.NJFA, 0)
                };

                config = {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categoryTotals),
                        datasets: [{
                            data: Object.values(categoryTotals),
                            backgroundColor: Object.values(colors),
                            borderWidth: 3,
                            borderColor: '#fff',
                            hoverOffset: 20
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'International Faculty Distribution by Academic Rank',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                };
            } else if (type === 'line') {
                config = {
                    type: 'line',
                    data: {
                        labels: programs,
                        datasets: [{
                            label: 'Total International Faculty per Program',
                            data: facultyData.map(d => d.total),
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            borderColor: '#667eea',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 3,
                            pointRadius: 8,
                            pointHoverRadius: 12
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Total International Faculty per Study Program',
                                font: { size: 16, weight: 'bold' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Faculty'
                                }
                            }
                        }
                    }
                };
            }

            currentChart = new Chart(ctx, config);
        }

        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            facultyData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="program-name">${row.program}</td>
                    <td><span class="category-badge gb">${row.GB}</span></td>
                    <td><span class="category-badge lk">${row.LK}</span></td>
                    <td><span class="category-badge l">${row.L}</span></td>
                    <td><span class="category-badge aa">${row.AA}</span></td>
                    <td><span class="category-badge njfa">${row.NJFA}</span></td>
                    <td><strong>${row.total}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Add interactive features
        function addInteractiveFeatures() {
            // Add tooltips for stat cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-8px) scale(1.02)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Add smooth scrolling to sections
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const content = document.querySelector('.content');
                    content.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }

        // Calculate additional statistics
        function calculateStats() {
            const totalFaculty = facultyData.reduce((sum, d) => sum + d.total, 0);
            const avgPerProgram = Math.round(totalFaculty / facultyData.length);
            const professors = facultyData.reduce((sum, d) => sum + d.GB, 0);
            
            // Update stat cards with animation
            animateNumber('totalFaculty', totalFaculty);
            animateNumber('avgPerProgram', avgPerProgram);
            animateNumber('professors', professors);
        }

        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const duration = 2000; // 2 seconds
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutCubic(progress));
                
                if (elementId === 'topCategory') {
                    element.textContent = 'L (112)';
                } else {
                    element.textContent = currentValue;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            const buttons = document.querySelectorAll('.btn');
            const currentActive = document.querySelector('.btn.active');
            const currentIndex = Array.from(buttons).indexOf(currentActive);
            
            if (e.key === 'ArrowLeft' && currentIndex > 0) {
                const prevButton = buttons[currentIndex - 1];
                const viewTypes = ['bar', 'pie', 'line', 'analysis', 'table'];
                showView(viewTypes[currentIndex - 1], prevButton);
                e.preventDefault();
            } else if (e.key === 'ArrowRight' && currentIndex < buttons.length - 1) {
                const nextButton = buttons[currentIndex + 1];
                const viewTypes = ['bar', 'pie', 'line', 'analysis', 'table'];
                showView(viewTypes[currentIndex + 1], nextButton);
                e.preventDefault();
            }
        });

        // Add print functionality
        function printDashboard() {
            window.print();
        }

        // Add fullscreen chart functionality
        function toggleFullscreen(elementId) {
            const element = document.getElementById(elementId);
            if (!document.fullscreenElement) {
                element.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Add data filtering functionality
        function filterByCategory(category) {
            const filteredData = facultyData.map(d => ({
                ...d,
                displayValue: d[category],
                category: category
            })).sort((a, b) => b.displayValue - a.displayValue);

            createFilteredChart(filteredData, category);
        }

        function createFilteredChart(data, category) {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }

            const categoryNames = {
                'GB': 'Professors (Guru Besar)',
                'LK': 'Associate Professors (Lektor Kepala)', 
                'L': 'Assistant Professors (Lektor)',
                'AA': 'Lecturers (Asisten Ahli)',
                'NJFA': 'Non-Functional Positions'
            };

            const colors = {
                GB: '#8884d8',
                LK: '#82ca9d', 
                L: '#ffc658',
                AA: '#ff7300',
                NJFA: '#00ff88'
            };

            const config = {
                type: 'bar',
                data: {
                    labels: data.map(d => d.program.replace('S1 ', '')),
                    datasets: [{
                        label: categoryNames[category],
                        data: data.map(d => d.displayValue),
                        backgroundColor: colors[category],
                        borderColor: colors[category],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${categoryNames[category]} Distribution Across Programs`,
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Faculty'
                            }
                        }
                    }
                }
            };

            currentChart = new Chart(ctx, config);
        }

        // Add search functionality
        function searchPrograms(searchTerm) {
            const filteredData = facultyData.filter(d => 
                d.program.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredData.length > 0) {
                updateTableWithFilteredData(filteredData);
            } else {
                showNoResultsMessage();
            }
        }

        function updateTableWithFilteredData(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="program-name">${row.program}</td>
                    <td><span class="category-badge gb">${row.GB}</span></td>
                    <td><span class="category-badge lk">${row.LK}</span></td>
                    <td><span class="category-badge l">${row.L}</span></td>
                    <td><span class="category-badge aa">${row.AA}</span></td>
                    <td><span class="category-badge njfa">${row.NJFA}</span></td>
                    <td><strong>${row.total}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function showNoResultsMessage() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px; color: #6c757d;">
                        <i>No programs found matching your search criteria</i>
                    </td>
                </tr>
            `;
        }

        // Add comparison functionality
        function comparePrograms(program1, program2) {
            const p1Data = facultyData.find(d => d.program === program1);
            const p2Data = facultyData.find(d => d.program === program2);
            
            if (p1Data && p2Data) {
                showComparisonModal(p1Data, p2Data);
            }
        }

        function showComparisonModal(prog1, prog2) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <h3 style="margin-bottom: 20px; color: #495057;">Program Comparison</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #667eea;">${prog1.program}</h4>
                            <p>Total Faculty: <strong>${prog1.total}</strong></p>
                            <p>GB: ${prog1.GB} | LK: ${prog1.LK} | L: ${prog1.L}</p>
                            <p>AA: ${prog1.AA} | NJFA: ${prog1.NJFA}</p>
                        </div>
                        <div>
                            <h4 style="color: #764ba2;">${prog2.program}</h4>
                            <p>Total Faculty: <strong>${prog2.total}</strong></p>
                            <p>GB: ${prog2.GB} | LK: ${prog2.LK} | L: ${prog2.L}</p>
                            <p>AA: ${prog2.AA} | NJFA: ${prog2.NJFA}</p>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        margin-top: 20px;
                        padding: 10px 20px;
                        background: #667eea;
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        width: 100%;
                    ">Close</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal on outside click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Enhanced export with more options
        function exportAdvanced(format, includeAnalysis = false) {
            if (format === 'pdf') {
                exportToPDF(includeAnalysis);
            } else if (format === 'excel') {
                exportToExcel(includeAnalysis);
            }
        }

        function exportToPDF(includeAnalysis) {
            // Simple PDF export using browser print
            const originalContent = document.body.innerHTML;
            const printContent = document.querySelector('.container').outerHTML;
            
            document.body.innerHTML = `
                <style>
                    @media print {
                        body { margin: 0; }
                        .btn-group, .floating-info { display: none !important; }
                        .container { box-shadow: none; border-radius: 0; }
                    }
                </style>
                ${printContent}
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            
            // Reinitialize after print
            setTimeout(() => {
                createChart('bar');
                addInteractiveFeatures();
            }, 100);
        }

        function exportToExcel(includeAnalysis) {
            // Create CSV with additional sheets simulation
            let csvContent = "Program,GB,LK,L,AA,NJFA,Total\n";
            facultyData.forEach(row => {
                csvContent += `${row.program},${row.GB},${row.LK},${row.L},${row.AA},${row.NJFA},${row.total}\n`;
            });
            
            if (includeAnalysis) {
                csvContent += "\n\nSUMMARY STATISTICS\n";
                csvContent += "Category,Total\n";
                csvContent += `GB,${facultyData.reduce((sum, d) => sum + d.GB, 0)}\n`;
                csvContent += `LK,${facultyData.reduce((sum, d) => sum + d.LK, 0)}\n`;
                csvContent += `L,${facultyData.reduce((sum, d) => sum + d.L, 0)}\n`;
                csvContent += `AA,${facultyData.reduce((sum, d) => sum + d.AA, 0)}\n`;
                csvContent += `NJFA,${facultyData.reduce((sum, d) => sum + d.NJFA, 0)}\n`;
            }
            
            downloadFile(csvContent, 'international_faculty_detailed.csv', 'text/csv');
        }

        // Add real-time statistics calculation
        function updateLiveStats() {
            const stats = calculateDetailedStats();
            displayLiveStats(stats);
        }

        function calculateDetailedStats() {
            const totalFaculty = facultyData.reduce((sum, d) => sum + d.total, 0);
            const categoryTotals = {
                GB: facultyData.reduce((sum, d) => sum + d.GB, 0),
                LK: facultyData.reduce((sum, d) => sum + d.LK, 0),
                L: facultyData.reduce((sum, d) => sum + d.L, 0),
                AA: facultyData.reduce((sum, d) => sum + d.AA, 0),
                NJFA: facultyData.reduce((sum, d) => sum + d.NJFA, 0)
            };
            
            const percentages = {};
            Object.keys(categoryTotals).forEach(key => {
                percentages[key] = ((categoryTotals[key] / totalFaculty) * 100).toFixed(1);
            });
            
            const topProgram = facultyData.reduce((prev, current) => 
                (prev.total > current.total) ? prev : current
            );
            
            const bottomProgram = facultyData.reduce((prev, current) => 
                (prev.total < current.total) ? prev : current
            );
            
            return {
                totalFaculty,
                categoryTotals,
                percentages,
                topProgram,
                bottomProgram,
                averagePerProgram: Math.round(totalFaculty / facultyData.length)
            };
        }

        function displayLiveStats(stats) {
            // Update the floating info with live stats
            const floatingInfo = document.querySelector('.floating-info');
            if (floatingInfo) {
                floatingInfo.innerHTML = `
                    📊 Live Stats: ${stats.totalFaculty} total faculty | 
                    Top: ${stats.topProgram.program.replace('S1 ', '')} (${stats.topProgram.total}) | 
                    L: ${stats.percentages.L}%
                `;
            }
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize everything with enhanced features
        window.onload = function() {
            createChart('bar');
            addInteractiveFeatures();
            calculateStats();
            updateLiveStats();
            
            // Add category filter buttons
            setTimeout(() => {
                const controlsDiv = document.querySelector('.controls');
                
                // Add filter section
                const filterDiv = document.createElement('div');
                filterDiv.style.marginTop = '20px';
                filterDiv.innerHTML = `
                    <div style="font-size: 14px; color: #6c757d; margin-bottom: 10px;">Filter by Category:</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 15px;">
                        <button onclick="filterByCategory('GB')" style="
                            padding: 6px 12px; border: 1px solid #8884d8; background: white; color: #8884d8; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#8884d8'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#8884d8';">👑 GB</button>
                        
                        <button onclick="filterByCategory('LK')" style="
                            padding: 6px 12px; border: 1px solid #82ca9d; background: white; color: #82ca9d; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#82ca9d'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#82ca9d';">🎖️ LK</button>
                        
                        <button onclick="filterByCategory('L')" style="
                            padding: 6px 12px; border: 1px solid #ffc658; background: white; color: #ffc658; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#ffc658'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#ffc658';">🏅 L</button>
                        
                        <button onclick="filterByCategory('AA')" style="
                            padding: 6px 12px; border: 1px solid #ff7300; background: white; color: #ff7300; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#ff7300'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#ff7300';">📚 AA</button>
                        
                        <button onclick="filterByCategory('NJFA')" style="
                            padding: 6px 12px; border: 1px solid #00ff88; background: white; color: #00ff88; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#00ff88'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#00ff88';">💼 NJFA</button>
                        
                        <button onclick="showView('bar', document.querySelector('.btn.active'))" style="
                            padding: 6px 12px; border: 1px solid #667eea; background: white; color: #667eea; 
                            border-radius: 15px; cursor: pointer; font-size: 11px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#667eea'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#667eea';">🔄 Reset</button>
                    </div>
                `;
                
                // Add search functionality
                const searchDiv = document.createElement('div');
                searchDiv.innerHTML = `
                    <div style="font-size: 14px; color: #6c757d; margin-bottom: 10px;">Search Programs:</div>
                    <input type="text" id="searchInput" placeholder="Type program name..." 
                           onkeyup="handleSearch(this.value)" style="
                        padding: 8px 15px; border: 1px solid #ddd; border-radius: 20px; width: 250px;
                        font-size: 14px; outline: none; transition: all 0.3s ease;
                    " onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 10px rgba(102,126,234,0.3)'"
                       onblur="this.style.borderColor='#ddd'; this.style.boxShadow='none'">
                `;
                
                // Add export section with advanced options
                const exportDiv = document.createElement('div');
                exportDiv.style.marginTop = '15px';
                exportDiv.innerHTML = `
                    <div style="font-size: 14px; color: #6c757d; margin-bottom: 10px;">Export Options:</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                        <button onclick="exportData('csv')" style="
                            padding: 8px 16px; border: 1px solid #667eea; background: white; color: #667eea; 
                            border-radius: 20px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#667eea'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#667eea';">📄 CSV</button>
                        
                        <button onclick="exportData('json')" style="
                            padding: 8px 16px; border: 1px solid #667eea; background: white; color: #667eea; 
                            border-radius: 20px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#667eea'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#667eea';">📋 JSON</button>
                        
                        <button onclick="exportAdvanced('pdf')" style="
                            padding: 8px 16px; border: 1px solid #e74c3c; background: white; color: #e74c3c; 
                            border-radius: 20px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#e74c3c'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#e74c3c';">🖨️ PDF</button>
                        
                        <button onclick="exportAdvanced('excel', true)" style="
                            padding: 8px 16px; border: 1px solid #27ae60; background: white; color: #27ae60; 
                            border-radius: 20px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;
                        " onmouseover="this.style.background='#27ae60'; this.style.color='white';" 
                           onmouseout="this.style.background='white'; this.style.color='#27ae60';">📊 Excel+</button>
                    </div>
                `;
                
                controlsDiv.appendChild(filterDiv);
                controlsDiv.appendChild(searchDiv);
                controlsDiv.appendChild(exportDiv);
                
                // Make functions globally available
                window.filterByCategory = filterByCategory;
                window.exportData = exportData;
                window.exportAdvanced = exportAdvanced;
                window.handleSearch = function(value) {
                    if (value.length > 0) {
                        searchPrograms(value);
                        showView('table');
                    } else {
                        populateTable();
                    }
                };
                
            }, 1000);
            
            // Update live stats every 5 seconds (in case data changes)
            setInterval(updateLiveStats, 5000);
            
            // Add keyboard shortcuts info
            setTimeout(() => {
                console.log('🎯 Keyboard Shortcuts:');
                console.log('← → Arrow keys: Navigate between views');
                console.log('Ctrl+P: Print dashboard');
                console.log('Escape: Close any open modals');
            }, 2000);
        };

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const buttons = document.querySelectorAll('.btn');
            const currentActive = document.querySelector('.btn.active');
            const currentIndex = Array.from(buttons).indexOf(currentActive);
            
            if (e.key === 'ArrowLeft' && currentIndex > 0) {
                const prevButton = buttons[currentIndex - 1];
                const viewTypes = ['bar', 'pie', 'line', 'analysis', 'table'];
                showView(viewTypes[currentIndex - 1], prevButton);
                e.preventDefault();
            } else if (e.key === 'ArrowRight' && currentIndex < buttons.length - 1) {
                const nextButton = buttons[currentIndex + 1];
                const viewTypes = ['bar', 'pie', 'line', 'analysis', 'table'];
                showView(viewTypes[currentIndex + 1], nextButton);
                e.preventDefault();
            } else if (e.ctrlKey && e.key === 'p') {
                printDashboard();
                e.preventDefault();
            } else if (e.key === 'Escape') {
                // Close any open modals
                const modals = document.querySelectorAll('[style*="position: fixed"]');
                modals.forEach(modal => modal.remove());
            }
        });

        // Add export functions to global scope
        function exportData(format) {
            if (format === 'csv') {
                exportToCSV();
            } else if (format === 'json') {
                exportToJSON();
            }
        }

        function exportToCSV() {
            const csvContent = [
                ['Program', 'GB', 'LK', 'L', 'AA', 'NJFA', 'Total'],
                ...facultyData.map(row => [
                    row.program, row.GB, row.LK, row.L, row.AA, row.NJFA, row.total
                ])
            ].map(row => row.join(',')).join('\n');
            
            downloadFile(csvContent, 'international_faculty_data.csv', 'text/csv');
        }

    </script>

    <!-- Add advanced tooltip functionality -->
    <script>
        // Advanced tooltip system
        class AdvancedTooltip {
            constructor() {
                this.tooltip = null;
                this.createTooltip();
            }

            createTooltip() {
                this.tooltip = document.createElement('div');
                this.tooltip.className = 'advanced-tooltip';
                this.tooltip.style.cssText = `
                    position: absolute;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    padding: 12px 16px;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 500;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    pointer-events: none;
                    z-index: 10000;
                    opacity: 0;
                    transition: all 0.3s ease;
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255,255,255,0.2);
                `;
                document.body.appendChild(this.tooltip);
            }

            show(text, x, y) {
                this.tooltip.innerHTML = text;
                this.tooltip.style.left = x + 15 + 'px';
                this.tooltip.style.top = y - 10 + 'px';
                this.tooltip.style.opacity = '1';
            }

            hide() {
                this.tooltip.style.opacity = '0';
            }
        }

        const advancedTooltip = new AdvancedTooltip();

        // Enhanced data processing functions
        function calculateTrends() {
            const trends = {
                highestGrowthPotential: [],
                balancedPrograms: [],
                seniorFacultyRatio: {}
            };

            facultyData.forEach(program => {
                const seniorRatio = (program.GB + program.LK) / program.total;
                const juniorRatio = (program.L + program.AA) / program.total;
                const nonFuncRatio = program.NJFA / program.total;

                trends.seniorFacultyRatio[program.program] = {
                    senior: seniorRatio,
                    junior: juniorRatio,
                    nonFunc: nonFuncRatio,
                    total: program.total
                };

                // Identify programs with high growth potential (low senior faculty)
                if (seniorRatio < 0.3 && program.total > 20) {
                    trends.highestGrowthPotential.push({
                        program: program.program,
                        ratio: seniorRatio,
                        total: program.total
                    });
                }

                // Identify well-balanced programs
                if (seniorRatio > 0.2 && seniorRatio < 0.5 && juniorRatio > 0.4) {
                    trends.balancedPrograms.push({
                        program: program.program,
                        seniorRatio: seniorRatio,
                        juniorRatio: juniorRatio
                    });
                }
            });

            return trends;
        }

        // Advanced analytics dashboard
        function createAdvancedAnalytics() {
            const trends = calculateTrends();
            const analytics = document.createElement('div');
            analytics.className = 'advanced-analytics';
            analytics.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                background: rgba(255,255,255,0.98);
                border-radius: 25px;
                padding: 30px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.2);
                z-index: 10000;
                overflow-y: auto;
                backdrop-filter: blur(15px);
            `;

            analytics.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="color: #495057; margin: 0;">🔬 Advanced Analytics</h2>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: #e74c3c; color: white; border: none; 
                        border-radius: 50%; width: 35px; height: 35px; cursor: pointer;
                        font-size: 18px; display: flex; align-items: center; justify-content: center;
                    ">×</button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 15px;">📈 Growth Potential Programs</h4>
                        ${trends.highestGrowthPotential.map(p => `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <strong>${p.program.replace('S1 ', '')}</strong><br>
                                <small>Senior Faculty: ${(p.ratio * 100).toFixed(1)}% | Total: ${p.total}</small>
                            </div>
                        `).join('')}
                    </div>

                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 15px;">
                        <h4 style="color: #27ae60; margin-bottom: 15px;">⚖️ Well-Balanced Programs</h4>
                        ${trends.balancedPrograms.map(p => `
                            <div style="margin-bottom: 8px; font-size: 14px;">
                                <strong>${p.program.replace('S1 ', '')}</strong><br>
                                <small>Senior: ${(p.seniorRatio * 100).toFixed(1)}% | Junior: ${(p.juniorRatio * 100).toFixed(1)}%</small>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #fff, #f8f9fa); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h4 style="color: #495057; margin-bottom: 15px;">📊 Faculty Composition Matrix</h4>
                    <canvas id="matrixChart" style="max-height: 300px;"></canvas>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="generateRecommendations()" style="
                        background: linear-gradient(135deg, #667eea, #764ba2); color: white; 
                        border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer;
                        font-weight: 600; transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                        🎯 Generate Recommendations
                    </button>
                    <button onclick="exportAnalytics()" style="
                        background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; 
                        border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer;
                        font-weight: 600; transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                        📤 Export Analysis
                    </button>
                </div>
            `;

            document.body.appendChild(analytics);
            createMatrixChart();
        }

        function createMatrixChart() {
            const ctx = document.getElementById('matrixChart');
            if (!ctx) return;

            const matrixData = facultyData.map(d => ({
                x: (d.GB + d.LK) / d.total * 100, // Senior faculty percentage
                y: d.total, // Total faculty
                r: (d.L + d.AA) / d.total * 50 + 5, // Junior faculty ratio as bubble size
                label: d.program.replace('S1 ', '')
            }));

            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Faculty Distribution Matrix',
                        data: matrixData,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: '#667eea',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Senior Faculty % vs Total Faculty (Bubble size = Junior Faculty %)'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.parsed;
                                    return [
                                        `Program: ${matrixData[context.dataIndex].label}`,
                                        `Senior Faculty: ${point.x.toFixed(1)}%`,
                                        `Total Faculty: ${point.y}`,
                                        `Junior Ratio: ${((point.r - 5) / 50 * 100).toFixed(1)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Senior Faculty Percentage (%)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Total Faculty Count'
                            }
                        }
                    }
                }
            });
        }

        function generateRecommendations() {
            const trends = calculateTrends();
            const recommendations = [];

            // Analyze each program
            facultyData.forEach(program => {
                const seniorRatio = (program.GB + program.LK) / program.total;
                const professorRatio = program.GB / program.total;
                
                if (professorRatio === 0) {
                    recommendations.push({
                        program: program.program,
                        priority: 'High',
                        recommendation: 'Consider recruiting Professor (Guru Besar) for academic leadership',
                        type: 'Leadership'
                    });
                }
                
                if (seniorRatio < 0.2) {
                    recommendations.push({
                        program: program.program,
                        priority: 'Medium',
                        recommendation: 'Increase senior faculty ratio through promotions or recruitment',
                        type: 'Career Development'
                    });
                }
                
                if (program.total < 20) {
                    recommendations.push({
                        program: program.program,
                        priority: 'Medium',
                        recommendation: 'Consider expanding international faculty to strengthen program',
                        type: 'Expansion'
                    });
                }
            });

            showRecommendations(recommendations);
        }

        function showRecommendations(recommendations) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; 
                display: flex; justify-content: center; align-items: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; border-radius: 20px; padding: 30px; 
                    max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;
                ">
                    <h3 style="color: #495057; margin-bottom: 20px;">🎯 Strategic Recommendations</h3>
                    <div style="space-y: 15px;">
                        ${recommendations.map(rec => `
                            <div style="
                                border-left: 4px solid ${rec.priority === 'High' ? '#e74c3c' : '#f39c12'};
                                padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;
                            ">
                                <div style="font-weight: bold; color: #495057;">
                                    ${rec.program.replace('S1 ', '')} 
                                    <span style="
                                        background: ${rec.priority === 'High' ? '#e74c3c' : '#f39c12'}; 
                                        color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 10px;
                                    ">${rec.priority}</span>
                                </div>
                                <div style="margin-top: 8px; color: #6c757d;">${rec.recommendation}</div>
                                <div style="margin-top: 5px; font-size: 12px; color: #667eea; font-weight: 500;">
                                    Category: ${rec.type}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        width: 100%; padding: 12px; background: #667eea; color: white; 
                        border: none; border-radius: 10px; cursor: pointer; margin-top: 20px;
                    ">Close Recommendations</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function exportAnalytics() {
            const trends = calculateTrends();
            const analyticsData = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalFaculty: facultyData.reduce((sum, d) => sum + d.total, 0),
                    totalPrograms: facultyData.length,
                    averagePerProgram: Math.round(facultyData.reduce((sum, d) => sum + d.total, 0) / facultyData.length)
                },
                trends: trends,
                recommendations: generateRecommendationData()
            };
            
            const jsonContent = JSON.stringify(analyticsData, null, 2);
            downloadFile(jsonContent, 'faculty_analytics_report.json', 'application/json');
        }

        function generateRecommendationData() {
            const recommendations = [];
            facultyData.forEach(program => {
                const seniorRatio = (program.GB + program.LK) / program.total;
                const professorRatio = program.GB / program.total;
                
                if (professorRatio === 0) {
                    recommendations.push({
                        program: program.program,
                        priority: 'High',
                        recommendation: 'Consider recruiting Professor (Guru Besar) for academic leadership'
                    });
                }
            });
            return recommendations;
        }

        // Add heatmap visualization
        function createHeatmapView() {
            const heatmapData = [];
            const categories = ['GB', 'LK', 'L', 'AA', 'NJFA'];
            
            facultyData.forEach((program, programIndex) => {
                categories.forEach((category, categoryIndex) => {
                    heatmapData.push({
                        x: categoryIndex,
                        y: programIndex,
                        v: program[category]
                    });
                });
            });

            // Create heatmap using Chart.js matrix chart
            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }

            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Faculty Heatmap',
                        data: heatmapData.map(d => ({
                            x: d.x,
                            y: d.y,
                            r: Math.max(d.v * 3, 5)
                        })),
                        backgroundColor: heatmapData.map(d => {
                            const intensity = d.v / Math.max(...heatmapData.map(item => item.v));
                            return `rgba(102, 126, 234, ${intensity})`;
                        }),
                        borderColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Faculty Distribution Heatmap'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            ticks: {
                                callback: function(value) {
                                    const labels = ['GB', 'LK', 'L', 'AA', 'NJFA'];
                                    return labels[value] || '';
                                }
                            },
                            min: -0.5,
                            max: 4.5
                        },
                        y: {
                            type: 'linear',
                            ticks: {
                                callback: function(value) {
                                    return facultyData[value]?.program.replace('S1 ', '') || '';
                                }
                            },
                            min: -0.5,
                            max: facultyData.length - 0.5
                        }
                    }
                }
            });
        }

        // Enhanced menu system
        function createAdvancedMenu() {
            const menu = document.createElement('div');
            menu.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 9999;
                background: rgba(255,255,255,0.95); border-radius: 15px;
                padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                backdrop-filter: blur(10px);
            `;
            
            menu.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 10px; color: #495057;">⚙️ Advanced Tools</div>
                <button onclick="createAdvancedAnalytics()" style="
                    display: block; width: 100%; padding: 8px; margin-bottom: 5px;
                    background: none; border: 1px solid #667eea; color: #667eea;
                    border-radius: 8px; cursor: pointer; font-size: 12px;
                " onmouseover="this.style.background='#667eea'; this.style.color='white'"
                   onmouseout="this.style.background='none'; this.style.color='#667eea'">
                    🔬 Advanced Analytics
                </button>
                <button onclick="createHeatmapView()" style="
                    display: block; width: 100%; padding: 8px; margin-bottom: 5px;
                    background: none; border: 1px solid #e74c3c; color: #e74c3c;
                    border-radius: 8px; cursor: pointer; font-size: 12px;
                " onmouseover="this.style.background='#e74c3c'; this.style.color='white'"
                   onmouseout="this.style.background='none'; this.style.color='#e74c3c'">
                    🔥 Heatmap View
                </button>
            `;
            
            document.body.appendChild(menu);
        }

        // Initialize advanced features
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                createAdvancedMenu();
                
                // Add tooltips to all interactive elements
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.addEventListener('mouseenter', function(e) {
                        const title = this.querySelector('.stat-label').textContent;
                        const value = this.querySelector('.stat-number').textContent;
                        advancedTooltip.show(`${title}: ${value}`, e.pageX, e.pageY);
                    });
                    card.addEventListener('mouseleave', () => advancedTooltip.hide());
                });
                
                // Make advanced functions globally available
                window.createAdvancedAnalytics = createAdvancedAnalytics;
                window.createHeatmapView = createHeatmapView;
                window.generateRecommendations = generateRecommendations;
                window.exportAnalytics = exportAnalytics;
                
            }, 2000);
        });

        // Performance monitoring
        function monitorPerformance() {
            const startTime = performance.now();
            
            // Monitor chart rendering time
            const observer = new MutationObserver(() => {
                const endTime = performance.now();
                console.log(`📊 Chart rendering time: ${(endTime - startTime).toFixed(2)}ms`);
            });
            
            observer.observe(document.getElementById('myChart'), { 
                childList: true, 
                subtree: true 
            });
        }

        // Auto-save dashboard state
        function saveDashboardState() {
            const state = {
                currentView: document.querySelector('.btn.active')?.textContent || 'Bar Chart',
                timestamp: Date.now(),
                userPreferences: {
                    darkMode: false,
                    animations: true
                }
            };
            
            try {
                // Note: localStorage not available in Claude artifacts
                console.log('Dashboard state:', state);
            } catch (e) {
                console.log('State saving not available in this environment');
            }
        }

        // Initialize performance monitoring
        setTimeout(monitorPerformance, 1000);
        
        // Save state on view changes
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) {
                setTimeout(saveDashboardState, 500);
            }
        });
    </script>
</body>
</html>
